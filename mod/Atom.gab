Atoms = gab\atom: .defclass (
  atom\chn:
  t => (state) => do
    chn = Channels.make
    atm = t.make(chn)

    Fibers.make () => chn <! state

    atm
  end
  {
    swap: (f args*) => do
      chn = self.atom\chn

      state = chn >! .unwrap

      state = f.(state args*)

      Fibers.make () => do
        chn <! state
      end

      self
    end
    @: () => do
      chn = self.atom\chn
      state = chn >! .unwrap

      Fibers.make () => chn <! state

      state
    end
  })

Atoms
